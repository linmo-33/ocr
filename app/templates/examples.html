<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>使用示例 - 验证码识别系统</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .example-section {
            margin-bottom: 40px;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }
        .code-block .comment {
            color: #6a9955;
        }
        .code-block .string {
            color: #ce9178;
        }
        .code-block .keyword {
            color: #569cd6;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }
        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">← 返回主页</a>
        
        <div class="header">
            <h1>📚 使用示例</h1>
            <p>各种验证码识别的代码示例</p>
        </div>

        <div class="card">
            <div class="example-section">
                <h2>1. OCR文字识别</h2>
                <h3>Python 示例</h3>
                <div class="code-block">
<span class="keyword">import</span> requests
<span class="keyword">import</span> base64

<span class="comment"># 读取图片并转换为Base64</span>
<span class="keyword">with</span> open(<span class="string">'captcha.png'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:
    image_base64 = base64.b64encode(f.read()).decode()

<span class="comment"># 发送识别请求</span>
response = requests.post(
    <span class="string">'http://localhost:7777/classification'</span>,
    json={
        <span class="string">'image'</span>: image_base64,
        <span class="string">'preprocess'</span>: <span class="keyword">True</span>
    }
)

result = response.json()
print(<span class="string">f"识别结果: {result['result']['text']}"</span>)
print(<span class="string">f"置信度: {result['result']['confidence']}"</span>)
                </div>

                <h3>JavaScript 示例</h3>
                <div class="code-block">
<span class="keyword">async function</span> recognizeText(imageBase64) {
    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">'http://localhost:7777/classification'</span>, {
        method: <span class="string">'POST'</span>,
        headers: {
            <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>
        },
        body: JSON.stringify({
            image: imageBase64,
            preprocess: <span class="keyword">true</span>
        })
    });
    
    <span class="keyword">const</span> result = <span class="keyword">await</span> response.json();
    console.log(<span class="string">'识别结果:'</span>, result.result.text);
    <span class="keyword">return</span> result;
}
                </div>

                <h3>cURL 示例</h3>
                <div class="code-block">
curl -X POST http://localhost:7777/classification \
  -H <span class="string">"Content-Type: application/json"</span> \
  -d <span class="string">'{
    "image": "iVBORw0KGgoAAAANSUhEUgAA...",
    "preprocess": true
  }'</span>
                </div>
            </div>

            <div class="example-section">
                <h2>2. 滑块验证码识别</h2>
                <h3>Python 示例</h3>
                <div class="code-block">
<span class="keyword">import</span> requests
<span class="keyword">import</span> base64

<span class="comment"># 读取滑块和背景图片</span>
<span class="keyword">with</span> open(<span class="string">'slider.png'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:
    slider_base64 = base64.b64encode(f.read()).decode()

<span class="keyword">with</span> open(<span class="string">'background.png'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:
    bg_base64 = base64.b64encode(f.read()).decode()

<span class="comment"># 发送识别请求</span>
response = requests.post(
    <span class="string">'http://localhost:7777/capcode'</span>,
    json={
        <span class="string">'slidingImage'</span>: slider_base64,
        <span class="string">'backImage'</span>: bg_base64,
        <span class="string">'simpleTarget'</span>: <span class="keyword">True</span>,
        <span class="string">'preprocess'</span>: <span class="keyword">False</span>
    }
)

result = response.json()
print(<span class="string">f"滑块位置: {result['result']['position']}px"</span>)
                </div>
            </div>

            <div class="example-section">
                <h2>3. 批量识别</h2>
                <h3>Python 示例</h3>
                <div class="code-block">
<span class="keyword">import</span> requests
<span class="keyword">import</span> base64
<span class="keyword">import</span> os

<span class="comment"># 批量读取图片</span>
images = []
<span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(<span class="string">'captchas'</span>):
    <span class="keyword">with</span> open(os.path.join(<span class="string">'captchas'</span>, filename), <span class="string">'rb'</span>) <span class="keyword">as</span> f:
        images.append(base64.b64encode(f.read()).decode())

<span class="comment"># 批量识别（最多20张）</span>
response = requests.post(
    <span class="string">'http://localhost:7777/batch/classification'</span>,
    json={
        <span class="string">'images'</span>: images[:20],
        <span class="string">'preprocess'</span>: <span class="keyword">True</span>
    }
)

results = response.json()
<span class="keyword">for</span> item <span class="keyword">in</span> results[<span class="string">'results'</span>]:
    print(<span class="string">f"图片 {item['index']}: {item['result']['text']}"</span>)
                </div>
            </div>

            <div class="example-section">
                <h2>4. 计算类验证码</h2>
                <h3>Python 示例</h3>
                <div class="code-block">
<span class="keyword">import</span> requests
<span class="keyword">import</span> base64

<span class="keyword">with</span> open(<span class="string">'math_captcha.png'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:
    image_base64 = base64.b64encode(f.read()).decode()

response = requests.post(
    <span class="string">'http://localhost:7777/calculate'</span>,
    json={<span class="string">'image'</span>: image_base64}
)

result = response.json()
print(<span class="string">f"计算结果: {result['result']}"</span>)
                </div>
            </div>

            <div class="example-section">
                <h2>5. 使用图片URL</h2>
                <h3>Python 示例</h3>
                <div class="code-block">
<span class="keyword">import</span> requests

<span class="comment"># 直接使用图片URL</span>
response = requests.post(
    <span class="string">'http://localhost:7777/classification'</span>,
    json={
        <span class="string">'image'</span>: <span class="string">'https://example.com/captcha.png'</span>,
        <span class="string">'preprocess'</span>: <span class="keyword">False</span>
    }
)

result = response.json()
print(result)
                </div>
            </div>

            <div class="example-section">
                <h2>6. 查看统计信息</h2>
                <h3>Python 示例</h3>
                <div class="code-block">
<span class="keyword">import</span> requests

<span class="comment"># 获取API统计</span>
response = requests.get(<span class="string">'http://localhost:7777/stats'</span>)
stats = response.json()

print(<span class="string">f"总请求数: {stats['total_requests']}"</span>)
print(<span class="string">f"成功率: {stats['success_rate']}"</span>)
print(<span class="string">f"平均响应时间: {stats['average_processing_time']}"</span>)

<span class="comment"># 查看各端点统计</span>
<span class="keyword">for</span> endpoint, data <span class="keyword">in</span> stats[<span class="string">'endpoints'</span>].items():
    print(<span class="string">f"\n{endpoint}:"</span>)
    print(<span class="string">f"  调用次数: {data['count']}"</span>)
    print(<span class="string">f"  成功: {data['success']}"</span>)
    print(<span class="string">f"  失败: {data['failed']}"</span>)
    print(<span class="string">f"  平均耗时: {data['avg_time']:.3f}s"</span>)
                </div>
            </div>

            <div class="example-section">
                <h2>7. 错误处理</h2>
                <h3>Python 示例</h3>
                <div class="code-block">
<span class="keyword">import</span> requests

<span class="keyword">try</span>:
    response = requests.post(
        <span class="string">'http://localhost:7777/classification'</span>,
        json={<span class="string">'image'</span>: image_base64},
        timeout=30
    )
    
    <span class="keyword">if</span> response.status_code == 200:
        result = response.json()
        print(<span class="string">f"成功: {result['result']['text']}"</span>)
    <span class="keyword">elif</span> response.status_code == 429:
        print(<span class="string">"请求过于频繁，请稍后再试"</span>)
    <span class="keyword">else</span>:
        error = response.json()
        print(<span class="string">f"错误: {error.get('error', '未知错误')}"</span>)
        
<span class="keyword">except</span> requests.exceptions.Timeout:
    print(<span class="string">"请求超时"</span>)
<span class="keyword">except</span> requests.exceptions.ConnectionError:
    print(<span class="string">"连接失败"</span>)
<span class="keyword">except</span> Exception <span class="keyword">as</span> e:
    print(<span class="string">f"发生错误: {e}"</span>)
                </div>
            </div>
        </div>

        <div class="footer">
            <p>
                <a href="/">← 返回主页</a> | 
                <a href="/docs" target="_blank">📖 API文档</a>
            </p>
        </div>
    </div>
</body>
</html>
